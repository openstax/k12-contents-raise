version: "3.8"
services:
  moodle:
    build:
      context: moodle
    networks:
      - raisemoodle
    environment: &moodleenv
      MOODLE_DOCKER_DBHOST: postgres
      MOODLE_DOCKER_DBNAME: $POSTGRES_DB
      MOODLE_DOCKER_DBUSER: $POSTGRES_USER
    ports:
      - 8000:80
    depends_on:
      - postgres
  cron:
    build:
      context: moodle
    command: /bin/bash -c "printenv | grep MOODLE > /etc/environment; cron -f"
    volumes: *moodlevolumes
    networks:
      - raisemoodle
    environment: *moodleenv
    depends_on:
      - moodle
  contentapi:
    build:
      context: contentapi
    volumes:
      - ../../html:/html
    networks:
      - raisemoodle
    ports:
      - 8800:80
  postgres:
    image: "postgres:13"
    volumes:
      - pgdata:/var/lib/postgresql/data
    networks:
      - raisemoodle
    environment:
      - POSTGRES_USER=moodle
      - POSTGRES_PASSWORD=moodledbpassword
      - POSTGRES_DB=moodle
networks:
  raisemoodle:
volumes:
  pgdata:
  moodledata:
